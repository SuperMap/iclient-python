import httpretty

from iclientpy.rest.api.distributedanalyst import DistributedAnalyst
from iclientpy.rest.apifactory import APIFactory
from iclientpy.rest.decorator import HttpMethod
from iclientpy.rest.api.model import *
from .abstractrest import AbstractRESTTestCase


class SpatialAnalystTestCase(AbstractRESTTestCase):
    @classmethod
    def setUpClass(cls):
        cls.init_rest(cls)
        cls.init_apifactory(cls)
        cls.init_api(cls, APIFactory.distributedanalyst_service)

    def test_aggregatepoints(self):
        single_jsonstr = '{"id":"30033df3_5834_41b2_8d0a_5be147d1e378","state":{"errorStackTrace":null,"endState":true,"startTime":1521622205048,"endTime":1521622220890,"publisherelapsedTime":3020,"runState":"FINISHED","errorMsg":null,"elapsedTime":302},"setting":{"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"appName":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/789.smwu","targetServiceInfos":[{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-789/rest"},{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-789/rest"}]},"type":"SUMMARYMESH","output":{"outputPath":"F:/BaiduNetdiskDownload/result/789.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/789.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkPoint_P","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmX","caption":"SmX","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmY","caption":"SmY","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"1","name":"SmLibTileID","caption":"SmLibTileID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"medallion","caption":"medallion","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"hack_license","caption":"hack_license","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"vecdor_id","caption":"vecdor_id","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"rate_code","caption":"rate_code","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"store_and_fwd_flag","caption":"store_and_fwd_flag","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_datetime","caption":"pickup_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_datetime","caption":"dropoff_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"passenger_count","caption":"passenger_count","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_time_in_secs","caption":"trip_time_in_secs","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_distance","caption":"trip_distance","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_longitude","caption":"pickup_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_latitude","caption":"pickup_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_longitude","caption":"dropoff_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_latitude","caption":"dropoff_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkPoint_P","bounds":"Left=-74.342308,Bottom=40.576233,Right=-73.58014699999998,Top=40.901577","available":true,"name":"smtiles_processing_newyorkPoint_P","readOnly":false,"datasetType":"POINT","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"sparkLogFile":null,"analyst":{"meshType":0,"statisticModes":"max","query":"-74.050,40.650,-73.850,40.850","mappingParameters":{"numericPrecision":1},"fields":"passenger_count","resultFieldNames":"max_passenger_count","resolution":"100","meshSizeUnit":"Meter"},"contextSetting":null,"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_aggregatepoints,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/aggregatepoints.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_aggregatepoints,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/aggregatepoints.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostAgggregatePointsEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkPoint_P'
        entity.type = SummaryAnalystType.SUMMARYMESH
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/result/789.smwu'
        entity.output.datasourcePath = 'F:/result/789.udb'
        entity.analyst = SummaryMeshAnalystSetting()
        entity.analyst.fields = 'passenger_count'
        entity.analyst.mappingParameters = MappingParameters()
        entity.analyst.mappingParameters.numericPrecision = 1
        entity.analyst.meshSizeUnit = DistanceUnit.Meter
        entity.analyst.query = '-74.050,40.650,-73.850,40.850'
        entity.analyst.resolution = 100
        entity.analyst.statisticModes = 'max'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/aggregatepoints/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_aggregatepoints,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/aggregatepoints.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_aggregatepoints_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/aggregatepoints/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_aggregatepoints_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/aggregatepoints/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_featurejoin(self):
        single_jsonstr = '{"id":"e6816473_8a3d_494c_925f_d2ee2d66c4ae","state":{"errorStackTrace":null,"endState":true,"startTime":1521623634638,"endTime":1521624477265,"publisherelapsedTime":0,"runState":"FAILED","errorMsg":"Job aborted due to stage failure: Task 2 in stage 74.1 failed 4 times, most recent failure: Lost task 2.3 in stage 74.1 (TID 2262, 192.168.43.1, executor 0): java.io.FileNotFoundException: F:\\BaiduNetdiskDownload\\supermap-iserver-9.0.1a-win64-deploy\\temp\\spark-488f4083-a9cc-4f82-a6ad-c5a87cc4510a\\executor-8cc3a6aa-f8fd-42ef-9a91-159ec2189ba8\\blockmgr-bdc3c1f3-9591-4f1f-b980-8d8845bf6bde\\00\\temp_shuffle_b55316ae-5bf8-4adf-be3a-e4cb5d149bc0 (系统找不到指定的路径。)\r\n\tat java.io.FileOutputStream.open0(Native Method)\r\n\tat java.io.FileOutputStream.open(Unknown Source)\r\n\tat java.io.FileOutputStream.<init>(Unknown Source)\r\n\tat org.apache.spark.storage.DiskBlockObjectWriter.initialize(DiskBlockObjectWriter.scala:102)\r\n\tat org.apache.spark.storage.DiskBlockObjectWriter.open(DiskBlockObjectWriter.scala:115)\r\n\tat org.apache.spark.storage.DiskBlockObjectWriter.write(DiskBlockObjectWriter.scala:229)\r\n\tat org.apache.spark.shuffle.sort.BypassMergeSortShuffleWriter.write(BypassMergeSortShuffleWriter.java:152)\r\n\tat org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:96)\r\n\tat org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:53)\r\n\tat org.apache.spark.scheduler.Task.run(Task.scala:99)\r\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:282)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n\tat java.lang.Thread.run(Unknown Source)\r\n\nDriver stacktrace:","elapsedTime":841963},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/7890.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/7890.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkPoint_P","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmX","caption":"SmX","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmY","caption":"SmY","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"1","name":"SmLibTileID","caption":"SmLibTileID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"medallion","caption":"medallion","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"hack_license","caption":"hack_license","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"vecdor_id","caption":"vecdor_id","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"rate_code","caption":"rate_code","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"store_and_fwd_flag","caption":"store_and_fwd_flag","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_datetime","caption":"pickup_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_datetime","caption":"dropoff_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"passenger_count","caption":"passenger_count","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_time_in_secs","caption":"trip_time_in_secs","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_distance","caption":"trip_distance","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_longitude","caption":"pickup_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_latitude","caption":"pickup_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_longitude","caption":"dropoff_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_latitude","caption":"dropoff_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkPoint_P","bounds":"Left=-74.342308,Bottom=40.576233,Right=-73.58014699999998,Top=40.901577","available":true,"name":"smtiles_processing_newyorkPoint_P","readOnly":false,"datasetType":"POINT","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"attributeMode":null,"temporalNearDistanceUnit":null,"mappingParameters":{"numericPrecision":1},"spatialNearDistanceUnit":"KILOMETER","temporalRelationship":null,"summaryMode":"max","joinFields":"name","temporalNearDistance":0,"specFields":null,"inputJoin":"{\"type\":\"udb\",\"info\":[{\"server\":\"F:\\\\BaiduNetdiskDownload\\\\data\\\\processing.udb\",\"datasetNames\":[\"newyorkRoads_L\"]}]}","joinOperation":"JOINONETOONE","spatialRelationship":"NEAR","spatialNearDistance":1,"attributeRelationship":null,"datasetFeatureJoin":"smtiles_processing_newyorkRoads_L","resultFieldNames":"max_name","summaryFields":"name","tolerance":0.001},"contextSetting":null,"serviceInfo":null,"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_featurejoin,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/featurejoin.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_featurejoin,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/featurejoin.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostFeatureJoinEntity()
        input = DatasetInputSetting()
        input.datasetName = 'smtiles_processing_newyorkPoint_P'
        entity.input = input
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/7890.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/7890.udb'
        entity.analyst = FeatureJoinAnalystSetting()
        entity.analyst.datasetFeatureJoin = 'smtiles_processing_newyorkRoads_L'
        entity.analyst.joinFields = 'name'
        entity.analyst.mappingParameters = MappingParameters()
        entity.analyst.mappingParameters.numericPrecision = 1
        entity.analyst.spatialNearDistance = 1
        entity.analyst.spatialNearDistanceUnit = Unit.KILOMETER
        entity.analyst.spatialRelationship = SpatialRelationShip.NEAR
        entity.analyst.summaryFields = 'name'
        entity.analyst.summaryMode = 'max'
        entity.analyst.tolerance = '0.001'
        entity.analyst.joinOperation = JoinOperation.JOINONETOONE
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/featurejoin/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_featurejoin,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/featurejoin.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_featurejoin_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/featurejoin/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_featurejoin_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/featurejoin/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_buffers(self):
        single_jsonstr = '{"id":"33893710_9aff_4add_aa90_7b5ed8f81157","state":{"errorStackTrace":null,"endState":true,"startTime":1521617363520,"endTime":1521617465227,"publisherelapsedTime":2048,"runState":"FINISHED","errorMsg":null,"elapsedTime":96989},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/1234.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/1234.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkPoint_P","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmX","caption":"SmX","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmY","caption":"SmY","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"1","name":"SmLibTileID","caption":"SmLibTileID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"medallion","caption":"medallion","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"hack_license","caption":"hack_license","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"vecdor_id","caption":"vecdor_id","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"rate_code","caption":"rate_code","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"store_and_fwd_flag","caption":"store_and_fwd_flag","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_datetime","caption":"pickup_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_datetime","caption":"dropoff_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"passenger_count","caption":"passenger_count","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_time_in_secs","caption":"trip_time_in_secs","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_distance","caption":"trip_distance","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_longitude","caption":"pickup_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_latitude","caption":"pickup_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_longitude","caption":"dropoff_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_latitude","caption":"dropoff_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkPoint_P","bounds":"Left=-74.342308,Bottom=40.576233,Right=-73.58014699999998,Top=40.901577","available":true,"name":"smtiles_processing_newyorkPoint_P","readOnly":false,"datasetType":"POINT","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"distanceUnit":"Meter","distance":"100","bounds":"-74.050,40.650,-73.850,40.850","distanceField":"pickup_latitude","dissolveField":"passenger_count"},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/1234.smwu","targetServiceInfos":[{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-1234/rest"},{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-1234/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_buffers,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/buffers.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_buffers,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/buffers.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostBuffersEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkPoint_P'
        entity.analyst = BuffersAnalystSetting()
        entity.analyst.bounds = '-74.050,40.650,-73.850,40.850'
        entity.analyst.dissolveField = 'passenger_count'
        entity.analyst.distance = '100'
        entity.analyst.distanceField = 'pickup_latitude'
        entity.analyst.distanceUnit = DistanceUnit.Meter
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/1234.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/1234.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/buffers/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_buffers,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/buffers.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_buffers_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/buffers/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_buffers_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/buffers/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_density(self):
        single_jsonstr = '{"id":"78e1a9fa_17e8_4c45_8654_ea14382c0820","state":{"errorStackTrace":null,"endState":true,"startTime":1521617965221,"endTime":1521618000718,"publisherelapsedTime":5967,"runState":"FINISHED","errorMsg":null,"elapsedTime":28268},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/234.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/234.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkPoint_P","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmX","caption":"SmX","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmY","caption":"SmY","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"1","name":"SmLibTileID","caption":"SmLibTileID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"medallion","caption":"medallion","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"hack_license","caption":"hack_license","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"vecdor_id","caption":"vecdor_id","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"rate_code","caption":"rate_code","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"store_and_fwd_flag","caption":"store_and_fwd_flag","type":"WTEXT","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_datetime","caption":"pickup_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_datetime","caption":"dropoff_datetime","type":"DATETIME","maxLength":255,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"passenger_count","caption":"passenger_count","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_time_in_secs","caption":"trip_time_in_secs","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"trip_distance","caption":"trip_distance","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_longitude","caption":"pickup_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"pickup_latitude","caption":"pickup_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_longitude","caption":"dropoff_longitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"dropoff_latitude","caption":"dropoff_latitude","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkPoint_P","bounds":"Left=-74.342308,Bottom=40.576233,Right=-73.58014699999998,Top=40.901577","available":true,"name":"smtiles_processing_newyorkPoint_P","readOnly":false,"datasetType":"POINT","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"areaUnit":"SquareMile","meshType":0,"method":0,"query":"-74.050,40.650,-73.850,40.850","radius":"300","fields":"passenger_count","radiusUnit":"Meter","resolution":"50","meshSizeUnit":"Meter"},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/234.smwu","targetServiceInfos":[{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-234/rest"},{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-234/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_density,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/density.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_density,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/density.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostDensityEntiy()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkPoint_P'
        entity.analyst = KernelDensityAnalystSetting()
        entity.analyst.areaUnit = AreaUnit.SquareMile
        entity.analyst.fields = 'passenger_count'
        entity.analyst.meshSizeUnit = DistanceUnit.Meter
        entity.analyst.meshType = 0
        entity.analyst.method = 0
        entity.analyst.query = '-74.050,40.650,-73.850,40.850'
        entity.analyst.radius = 300
        entity.analyst.radiusUnit = DistanceUnit.Meter
        entity.analyst.resolution = 50
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/234.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/234.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/density/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_density,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/density.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_density_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/density/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_density_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/density/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_overlay(self):
        single_jsonstr = '{"id":"83674e76_9aa7_4c8c_83d1_27acd5b4b3dc","state":{"errorStackTrace":null,"endState":true,"startTime":1521618847702,"endTime":1521618857345,"publisherelapsedTime":4041,"runState":"FINISHED","errorMsg":null,"elapsedTime":0},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/34.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/34.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkZone_R","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriW","caption":"SmSdriW","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriN","caption":"SmSdriN","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriE","caption":"SmSdriE","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriS","caption":"SmSdriS","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":true,"defaultValue":"0","name":"SmArea","caption":"SmArea","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmPerimeter","caption":"SmPerimeter","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"OBJECTID","caption":"OBJECTID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Leng","caption":"Shape_Leng","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Area","caption":"Shape_Area","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"zone","caption":"zone","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"LocationID","caption":"LocationID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"borough","caption":"borough","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkZone_R","bounds":"Left=-74.25551784310493,Bottom=40.496084221255856,Right=-73.70014827248451,Top=40.91538866049913","available":true,"name":"smtiles_processing_newyorkZone_R","readOnly":false,"datasetType":"REGION","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"mode":"clip","overlayFields":null,"inputOverlay":"{\"type\":\"udb\",\"info\":[{\"server\":\"F:\\\\BaiduNetdiskDownload\\\\data\\\\processing.udb\",\"datasetNames\":[\"singleRegion_R\"]}]}","datasetOverlay":"smtiles_processing_singleRegion_R","srcFields":"zone,LocationID"},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/34.smwu","targetServiceInfos":[{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-34/rest"},{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-34/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_overlay,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/overlay.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_overlay,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/overlay.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostOverlayEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkZone_R'
        entity.analyst = OverlayAnalystSetting()
        entity.analyst.mode = OverlayMode.clip
        entity.analyst.datasetOverlay = 'smtiles_processing_singleRegion_R'
        entity.analyst.srcFields = 'zone,LocationID'
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/34.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/34.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/overlay/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_overlay,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/overlay.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_overlay_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/overlay/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_overlay_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/overlay/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_query(self):
        single_jsonstr = '{"id":"c43dde79_39bc_4a05_b90a_7a288f92fc8b","state":{"errorStackTrace":null,"endState":true,"startTime":1521619385593,"endTime":1521619395358,"publisherelapsedTime":3794,"runState":"FINISHED","errorMsg":null,"elapsedTime":0},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/4.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/4.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkZone_R","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriW","caption":"SmSdriW","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriN","caption":"SmSdriN","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriE","caption":"SmSdriE","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriS","caption":"SmSdriS","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":true,"defaultValue":"0","name":"SmArea","caption":"SmArea","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmPerimeter","caption":"SmPerimeter","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"OBJECTID","caption":"OBJECTID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Leng","caption":"Shape_Leng","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Area","caption":"Shape_Area","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"zone","caption":"zone","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"LocationID","caption":"LocationID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"borough","caption":"borough","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkZone_R","bounds":"Left=-74.25551784310493,Bottom=40.496084221255856,Right=-73.70014827248451,Top=40.91538866049913","available":true,"name":"smtiles_processing_newyorkZone_R","readOnly":false,"datasetType":"REGION","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"mode":"CONTAIN","bufferAnalystParameter":null,"geometryQuery":{"center":{"x":-74.17673741883826,"y":40.689383969689565},"parts":[232],"style":null,"prjCoordSys":null,"id":1,"type":"REGION","partTopo":[1],"points":[{"x":-74.18438485130123,"y":40.694915715275066},{"x":-74.18442098607743,"y":40.69501481938534},{"x":-74.18443010009393,"y":40.69510487207723},{"x":-74.18431391307595,"y":40.6957979484288},{"x":-74.18421529008282,"y":40.69613090960056},{"x":-74.18395527152761,"y":40.696994802032435},{"x":-74.18384777198311,"y":40.69742678818416},{"x":-74.18368607800609,"y":40.69771462041186},{"x":-74.18356970177528,"y":40.698245631508186},{"x":-74.18349783654278,"y":40.698371556285274},{"x":-74.18347996556307,"y":40.69847956878113},{"x":-74.1834441340589,"y":40.69862356433069},{"x":-74.18321179540206,"y":40.70000971991229},{"x":-74.18309617031672,"y":40.70113497484184},{"x":-74.18310663664276,"y":40.702305469772625},{"x":-74.18307993413418,"y":40.702548521875485},{"x":-74.1830352049734,"y":40.70277353500767},{"x":-74.18293656492021,"y":40.70307948655266},{"x":-74.18278391333556,"y":40.703385343473116},{"x":-74.18258620766908,"y":40.703655107003186},{"x":-74.18237043144138,"y":40.70387081725013},{"x":-74.18214562046215,"y":40.704059501110166},{"x":-74.18197473118546,"y":40.704176250224144},{"x":-74.18174985369524,"y":40.70431091273643},{"x":-74.1815159407584,"y":40.70441854893945},{"x":-74.18126402474262,"y":40.70452615428804},{"x":-74.18075114695525,"y":40.70470533626533},{"x":-74.17941059383146,"y":40.705261244640916},{"x":-74.17881673427142,"y":40.70545830300568},{"x":-74.17825886147438,"y":40.70563741878203},{"x":-74.17770998144817,"y":40.70580754896946},{"x":-74.1770351163841,"y":40.706004478106365},{"x":-74.17693615796064,"y":40.70604932792762},{"x":-74.17683721177916,"y":40.706103181526665},{"x":-74.17659446928151,"y":40.70632786047372},{"x":-74.1763698047414,"y":40.70660659266363},{"x":-74.17623504836665,"y":40.706804444751555},{"x":-74.17602830456562,"y":40.707020182323845},{"x":-74.17593839882808,"y":40.707101063044234},{"x":-74.17583947950763,"y":40.70717292490147},{"x":-74.17560559852286,"y":40.70728957689775},{"x":-74.17532667378207,"y":40.707379142279386},{"x":-74.17510169719982,"y":40.70742378095454},{"x":-74.17470574163367,"y":40.70750414683223},{"x":-74.17412074297715,"y":40.70757519299479},{"x":-74.17383278241697,"y":40.70763773581803},{"x":-74.17341873872113,"y":40.70765505010267},{"x":-74.17269869520963,"y":40.70770787042096},{"x":-74.17183470590726,"y":40.70781447849014},{"x":-74.17158272878356,"y":40.70785907927665},{"x":-74.17128569327,"y":40.70786759140313},{"x":-74.17115065842515,"y":40.70785836452062},{"x":-74.1698904793193,"y":40.70787429647114},{"x":-74.16882825390883,"y":40.70783654310294},{"x":-74.16675779508456,"y":40.70775214924016},{"x":-74.16437230674146,"y":40.7076852975383},{"x":-74.16395821065196,"y":40.7076666310741},{"x":-74.16228384923015,"y":40.707609959141536},{"x":-74.16076246785572,"y":40.7075265394118},{"x":-74.16051936991828,"y":40.70749014521677},{"x":-74.1602762717192,"y":40.70745375153468},{"x":-74.16000609678917,"y":40.7073722978682},{"x":-74.15933062041728,"y":40.707146157229985},{"x":-74.15898837247902,"y":40.70702857958549},{"x":-74.15886229230624,"y":40.70699236994408},{"x":-74.15821379846203,"y":40.706757273897665},{"x":-74.15453008374628,"y":40.70552716021972},{"x":-74.15403463683684,"y":40.705319329654316},{"x":-74.15395351422886,"y":40.705256181984375},{"x":-74.15381839576516,"y":40.70520195693953},{"x":-74.15370150920883,"y":40.70528281451393},{"x":-74.1531701271037,"y":40.70511995211107},{"x":-74.15311623861228,"y":40.70519190088159},{"x":-74.15300815547567,"y":40.70515572457505},{"x":-74.1535287205739,"y":40.704247132950485},{"x":-74.1537978811178,"y":40.70371632018986},{"x":-74.15507234623796,"y":40.7014313089032},{"x":-74.15537764516235,"y":40.70096358040483},{"x":-74.15568302320054,"y":40.70054087120634},{"x":-74.15593441994946,"y":40.7001360880987},{"x":-74.15628468419996,"y":40.69963241579915},{"x":-74.1573802722244,"y":40.69796841188211},{"x":-74.15747004992589,"y":40.69781548724323},{"x":-74.15751485799865,"y":40.697689504674955},{"x":-74.15755064868051,"y":40.6975545046261},{"x":-74.15822428372726,"y":40.696583144573026},{"x":-74.1594367665844,"y":40.694766278847204},{"x":-74.15950859018284,"y":40.694640339008},{"x":-74.16006574243603,"y":40.693983937563765},{"x":-74.1604964999741,"y":40.69310225016937},{"x":-74.16254471227094,"y":40.690170271624396},{"x":-74.16271537909908,"y":40.68990943505231},{"x":-74.16282318778191,"y":40.68975654324384},{"x":-74.1628411955947,"y":40.689756571702574},{"x":-74.16286820731388,"y":40.68975661439596},{"x":-74.16298528604703,"y":40.68977480682679},{"x":-74.16301235364415,"y":40.68981086425985},{"x":-74.16313849195768,"y":40.68986508579595},{"x":-74.16322854481834,"y":40.68987423204059},{"x":-74.16332760154421,"y":40.689883392623265},{"x":-74.16344466602003,"y":40.689892581844134},{"x":-74.16372384205705,"y":40.689929039482216},{"x":-74.16402102555088,"y":40.68996552643978},{"x":-74.16409305657959,"y":40.6899656410405},{"x":-74.1641470383967,"y":40.68993871599138},{"x":-74.16428206903065,"y":40.68992092370001},{"x":-74.16442604850292,"y":40.689867131215706},{"x":-74.16458796721435,"y":40.689768349263794},{"x":-74.16471382950755,"y":40.68964249900229},{"x":-74.1648306197089,"y":40.689471616116826},{"x":-74.16491135349172,"y":40.68927366475434},{"x":-74.16519875577852,"y":40.68879693088083},{"x":-74.16534258820519,"y":40.688644099136475},{"x":-74.1653964214603,"y":40.68851813426137},{"x":-74.16552216496123,"y":40.68831125184438},{"x":-74.16568363994925,"y":40.68791535022667},{"x":-74.16579145869198,"y":40.68776246126093},{"x":-74.16574598894873,"y":40.687465267739434},{"x":-74.16573684870161,"y":40.687375216549704},{"x":-74.1657183368413,"y":40.68704205173649},{"x":-74.1657361685492,"y":40.68692503290451},{"x":-74.16580790381263,"y":40.68672706779092},{"x":-74.16596054286488,"y":40.68643919625432},{"x":-74.16631091472863,"y":40.685908544690584},{"x":-74.16641876519212,"y":40.685773663704495},{"x":-74.16665228768827,"y":40.68537787971206},{"x":-74.16686800561017,"y":40.685117122179584},{"x":-74.16729920548252,"y":40.684433542311965},{"x":-74.16772152951569,"y":40.68383098254337},{"x":-74.16782035484384,"y":40.683678080969756},{"x":-74.1679551464121,"y":40.68348922333439},{"x":-74.16807202219641,"y":40.683363362255974},{"x":-74.1681348696945,"y":40.68323741340913},{"x":-74.16839549206182,"y":40.68288669540376},{"x":-74.16877281127464,"y":40.68228406632927},{"x":-74.1690693948423,"y":40.68188839036853},{"x":-74.16920415418625,"y":40.681672523256594},{"x":-74.16938392644039,"y":40.68144772635842},{"x":-74.16972533377967,"y":40.68090806723616},{"x":-74.16986020160272,"y":40.680764230247014},{"x":-74.16995895821847,"y":40.68055730860222},{"x":-74.1703184241958,"y":40.68004469189357},{"x":-74.17041724815653,"y":40.67988278898506},{"x":-74.17057885048423,"y":40.679540916748905},{"x":-74.17083948732467,"y":40.67918120083976},{"x":-74.17135162275478,"y":40.678362715678254},{"x":-74.17142353799511,"y":40.678272798277824},{"x":-74.17151341308663,"y":40.678146896100024},{"x":-74.17183699690133,"y":40.67771525765043},{"x":-74.17190891349834,"y":40.6776253405636},{"x":-74.17273577850052,"y":40.676456242504734},{"x":-74.17305046101207,"y":40.67608761819861},{"x":-74.17313134896924,"y":40.675970705958186},{"x":-74.17319430120374,"y":40.675907785639474},{"x":-74.17349107762857,"y":40.675611161753935},{"x":-74.17413841201926,"y":40.67482893021931},{"x":-74.17427333906615,"y":40.67471210953175},{"x":-74.17474997281407,"y":40.67421771123737},{"x":-74.17490286476963,"y":40.674064907010745},{"x":-74.1752895576841,"y":40.673651392160956},{"x":-74.17594603628089,"y":40.67294121552107},{"x":-74.17620683771442,"y":40.67266254507619},{"x":-74.17631471757194,"y":40.672518670027536},{"x":-74.17653056369136,"y":40.67229394582304},{"x":-74.1766833793029,"y":40.67207811843973},{"x":-74.17687218492067,"y":40.6718353416343},{"x":-74.1769890618278,"y":40.67168247891891},{"x":-74.17724093846508,"y":40.67145781745699},{"x":-74.17744790494109,"y":40.67132311618279},{"x":-74.17768192747295,"y":40.671215472430426},{"x":-74.17792495719245,"y":40.67110784457249},{"x":-74.17852816231677,"y":40.67093780962817},{"x":-74.17878029560994,"y":40.670902228264744},{"x":-74.17902345813472,"y":40.67089364290799},{"x":-74.17923063022559,"y":40.670912006942686},{"x":-74.17969014692909,"y":40.67105685771485},{"x":-74.17987935223628,"y":40.67111120641673},{"x":-74.18000551228648,"y":40.67116544636134},{"x":-74.18020370015209,"y":40.67120180387017},{"x":-74.18123995593623,"y":40.67160876619574},{"x":-74.18204193256005,"y":40.67193429554524},{"x":-74.18375390373329,"y":40.672558550424924},{"x":-74.1842765872028,"y":40.67282057807544},{"x":-74.18449287989188,"y":40.67293800765639},{"x":-74.18482640634551,"y":40.673181696142024},{"x":-74.18494359639243,"y":40.673271940147906},{"x":-74.18504278486493,"y":40.67337115598141},{"x":-74.18538556507494,"y":40.67382194609258},{"x":-74.18585479483461,"y":40.674579085902266},{"x":-74.18661264364655,"y":40.67570589217634},{"x":-74.18724418444583,"y":40.67666140798622},{"x":-74.18758705015502,"y":40.67721124497457},{"x":-74.1878666061295,"y":40.677535878218954},{"x":-74.18811011614633,"y":40.67784243998671},{"x":-74.18843496833202,"y":40.67840125078482},{"x":-74.18868756203507,"y":40.678779859293165},{"x":-74.18896728404661,"y":40.67925755743883},{"x":-74.18927395531942,"y":40.67968128322553},{"x":-74.1894094194973,"y":40.680014663208084},{"x":-74.18961734933929,"y":40.68071732401536},{"x":-74.18968978444782,"y":40.6810595937491},{"x":-74.18969886211217,"y":40.681122635706295},{"x":-74.1897530272843,"y":40.681239781308044},{"x":-74.18983433161007,"y":40.68146501989592},{"x":-74.18988866174553,"y":40.68172622414372},{"x":-74.18991619367807,"y":40.6821764562654},{"x":-74.18991662790295,"y":40.682554610067214},{"x":-74.18988998556421,"y":40.682878692864925},{"x":-74.18990825374946,"y":40.68310381712786},{"x":-74.18987262759673,"y":40.683445890929846},{"x":-74.18985483535329,"y":40.68363493516748},{"x":-74.189792226745,"y":40.68400397097878},{"x":-74.18970302999026,"y":40.68474210808358},{"x":-74.18968526969267,"y":40.68495816337428},{"x":-74.18955143748042,"y":40.68602935468425},{"x":-74.18948031717834,"y":40.68682154680344},{"x":-74.18944465363796,"y":40.68712760623622},{"x":-74.18939996538097,"y":40.68741564204878},{"x":-74.18931920864281,"y":40.687658594338394},{"x":-74.18931932326414,"y":40.68775763468695},{"x":-74.1893374566466,"y":40.68786571130916},{"x":-74.18932862959753,"y":40.6880187573679},{"x":-74.18927480279625,"y":40.688189729269496},{"x":-74.18914916275051,"y":40.68854964792195},{"x":-74.18891554903585,"y":40.688972397133064},{"x":-74.18862788296804,"y":40.68936803834381},{"x":-74.18771936508269,"y":40.690113705672836},{"x":-74.18716160739118,"y":40.690517869359574},{"x":-74.18629795614352,"y":40.691110566321896},{"x":-74.18583908166207,"y":40.69137085448384},{"x":-74.18556020749917,"y":40.691568438761905},{"x":-74.18438485130123,"y":40.694915715275066}]},"inputQuery":null,"datasetQuery":"smtiles_processing_newyorkZone_R","attributeFilter":null},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/4.smwu","targetServiceInfos":[{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-4/rest"},{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-4/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_query,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/query.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_query,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/query.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostQueryEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkZone_R'
        entity.analyst = SpatialQueryGeoAnalystSetting()
        entity.analyst.mode = SpatialQueryMode.CONTAIN
        entity.analyst.datasetQuery = 'smtiles_processing_newyorkZone_R'
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/4.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/4.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/query/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_query,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/query.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_query_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/query/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_query_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/query/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_summary_attributes(self):
        single_jsonstr = '{"id":"d9ba9038_61b4_441b_91b7_22325055ecdf","state":{"errorStackTrace":null,"endState":true,"startTime":1521619905390,"endTime":1521619912424,"publisherelapsedTime":2190,"runState":"FINISHED","errorMsg":null,"elapsedTime":0},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/51.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/51.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkZone_R","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriW","caption":"SmSdriW","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriN","caption":"SmSdriN","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriE","caption":"SmSdriE","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriS","caption":"SmSdriS","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":true,"defaultValue":"0","name":"SmArea","caption":"SmArea","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmPerimeter","caption":"SmPerimeter","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"OBJECTID","caption":"OBJECTID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Leng","caption":"Shape_Leng","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Area","caption":"Shape_Area","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"zone","caption":"zone","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"LocationID","caption":"LocationID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"borough","caption":"borough","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkZone_R","bounds":"Left=-74.25551784310493,Bottom=40.496084221255856,Right=-73.70014827248451,Top=40.91538866049913","available":true,"name":"smtiles_processing_newyorkZone_R","readOnly":false,"datasetType":"REGION","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"groupField":"borough","statisticModes":"max","resultField":null,"attributeField":"LocationID"},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/51.smwu","targetServiceInfos":[{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-51/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_summary_attributes,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryattributes.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_summary_attributes,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryattributes.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostSummaryAttributesEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkZone_R'
        entity.analyst = SummaryAttributesAnalystSetting()
        entity.analyst.statisticModes = 'max'
        entity.analyst.attributeField = 'LocationID'
        entity.analyst.groupField = 'borough'
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/51.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/51.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryattributes/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_summary_attributes,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryattributes.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_summary_attributes_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryattributes/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_summary_attributes_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryattributes/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_summary_region(self):
        single_jsonstr = '{"id":"d9ba9038_61b4_441b_91b7_22325055ecdf","state":{"errorStackTrace":null,"endState":true,"startTime":1521619905390,"endTime":1521619912424,"publisherelapsedTime":2190,"runState":"FINISHED","errorMsg":null,"elapsedTime":0},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/51.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/51.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkZone_R","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriW","caption":"SmSdriW","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriN","caption":"SmSdriN","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriE","caption":"SmSdriE","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriS","caption":"SmSdriS","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":true,"defaultValue":"0","name":"SmArea","caption":"SmArea","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmPerimeter","caption":"SmPerimeter","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"OBJECTID","caption":"OBJECTID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Leng","caption":"Shape_Leng","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Area","caption":"Shape_Area","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"zone","caption":"zone","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"LocationID","caption":"LocationID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"borough","caption":"borough","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkZone_R","bounds":"Left=-74.25551784310493,Bottom=40.496084221255856,Right=-73.70014827248451,Top=40.91538866049913","available":true,"name":"smtiles_processing_newyorkZone_R","readOnly":false,"datasetType":"REGION","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"groupField":"borough","statisticModes":"max","resultField":null,"attributeField":"LocationID"},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/51.smwu","targetServiceInfos":[{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-51/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_summary_region,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryregion.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_summary_region,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryregion.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostSummaryRegionEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkZone_R'
        entity.analyst = SummaryWithinMeshAnalystSetting()
        entity.analyst.mappingParameters = MappingParameters()
        entity.analyst.mappingParameters.numericPrecision = 1
        entity.analyst.meshSizeUnit = DistanceUnit.Meter
        entity.analyst.meshType = 0
        entity.analyst.query = '-74.050,40.650,-73.850,40.850'
        entity.analyst.resolution = 100
        entity.analyst.standardSummaryFields = False
        entity.analyst.sumShape = True
        entity.analyst.weightedFields = 'zone'
        entity.analyst.weightedStatisticModes = 'max'
        entity.analyst.weightedSummaryFields = True
        entity.type = SummaryAnalystType.SUMMARYMESH
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/6.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/6.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryregion/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_summary_region,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryregion.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_summary_region_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryregion/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_summary_region_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/summaryregion/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_topologyvalidator(self):
        single_jsonstr = '{"id":"f7ea82c3_6a88_446c_9306_b91eedd7deaf","state":{"errorStackTrace":null,"endState":true,"startTime":1521622311551,"endTime":1521622315970,"publisherelapsedTime":2475,"runState":"FINISHED","errorMsg":null,"elapsedTime":0},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/7.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/7.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkZone_R","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriW","caption":"SmSdriW","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriN","caption":"SmSdriN","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriE","caption":"SmSdriE","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriS","caption":"SmSdriS","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":true,"defaultValue":"0","name":"SmArea","caption":"SmArea","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmPerimeter","caption":"SmPerimeter","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"OBJECTID","caption":"OBJECTID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Leng","caption":"Shape_Leng","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Area","caption":"Shape_Area","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"zone","caption":"zone","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"LocationID","caption":"LocationID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"borough","caption":"borough","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkZone_R","bounds":"Left=-74.25551784310493,Bottom=40.496084221255856,Right=-73.70014827248451,Top=40.91538866049913","available":true,"name":"smtiles_processing_newyorkZone_R","readOnly":false,"datasetType":"REGION","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"inputValidating":null,"rule":"REGIONNOOVERLAP","datasetTopology":null,"tolerance":"0.001"},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/7.smwu","targetServiceInfos":[{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-7/rest"},{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-7/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_topologyvalidator,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/topologyvalidator.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_topologyvalidator,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/topologyvalidator.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostTopologyValidatorEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkZone_R'
        entity.analyst = TopologyvalidatorAnalystSetting()
        entity.analyst.tolerance = '0.001'
        entity.analyst.rule = TopologyValidatorRuleType.REGIONNOOVERLAP
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/7.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/7.udb'
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/topologyvalidator/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_topologyvalidator,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/topologyvalidator.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_topologyvalidator_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/topologyvalidator/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_topologyvalidator_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/topologyvalidator/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')

    def test_vectorclip(self):
        single_jsonstr = '{"id":"d57e82ca_8880_49a7_b08b_5660f84542c1","state":{"errorStackTrace":null,"endState":true,"startTime":1521622436666,"endTime":1521622441339,"publisherelapsedTime":2469,"runState":"FINISHED","errorMsg":null,"elapsedTime":0},"setting":{"output":{"outputPath":"F:/BaiduNetdiskDownload/result/8.smwu","datasourcePath":"F:/BaiduNetdiskDownload/result/8.udb","datasetName":"analystResult","type":"UDB"},"args":null,"input":{"datasetName":"smtiles_processing_newyorkZone_R","numSlices":36,"specField":null,"datasetInfo":{"fieldInfos":[{"isRequired":true,"defaultValue":"","name":"SmID","caption":"SmID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriW","caption":"SmSdriW","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriN","caption":"SmSdriN","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriE","caption":"SmSdriE","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmSdriS","caption":"SmSdriS","type":"SINGLE","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmUserID","caption":"SmUserID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":true,"defaultValue":"0","name":"SmArea","caption":"SmArea","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"0","name":"SmPerimeter","caption":"SmPerimeter","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"0","name":"SmGeometrySize","caption":"SmGeometrySize","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":true,"defaultValue":"-1","name":"SmGeoPosition","caption":"SmGeoPosition","type":"INT64","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":true},{"isRequired":false,"defaultValue":"","name":"OBJECTID","caption":"OBJECTID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Leng","caption":"Shape_Leng","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"Shape_Area","caption":"Shape_Area","type":"DOUBLE","maxLength":8,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"zone","caption":"zone","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"LocationID","caption":"LocationID","type":"INT32","maxLength":4,"isZeroLengthAllowed":true,"isSystemField":false},{"isRequired":false,"defaultValue":"","name":"borough","caption":"borough","type":"WTEXT","maxLength":254,"isZeroLengthAllowed":true,"isSystemField":false}],"epsgCode":4326,"datasetName":"newyorkZone_R","bounds":"Left=-74.25551784310493,Bottom=40.496084221255856,Right=-73.70014827248451,Top=40.91538866049913","available":true,"name":"smtiles_processing_newyorkZone_R","readOnly":false,"datasetType":"REGION","type":"UDB","url":"F:\\BaiduNetdiskDownload\\data\\processing.udb"}},"DEFAULT_MASTER_ADRESS":"local[*] ","referToken":"Zy7cGb0G4r_cz8F7To4l7G4pYs5U41rf-v5nk5LfUIP0AvT6UoxGw4AiAYi-ENKxkOWIiYqvUkMWOagsB2u2rw..","mainClass":null,"sparkLogFile":null,"appName":null,"analyst":{"datasetVectorClip":"smtiles_processing_singleRegion_R","mode":"clip","bufferAnalystParameter":null,"geometryClip":{"center":{"x":-73.92544215728833,"y":40.75855083570022},"parts":[73],"style":null,"prjCoordSys":null,"id":1,"type":"REGION","partTopo":[1],"points":[{"x":-73.86354276983026,"y":40.75855083570022},{"x":-73.86377831568772,"y":40.76383441532751},{"x":-73.86448316061389,"y":40.769077783723525},{"x":-73.86565194031326,"y":40.77424103568874},{"x":-73.86727575966661,"y":40.77928487575804},{"x":-73.86934226042817,"y":40.784170917262934},{"x":-73.87183571527936,"y":40.78886197447732},{"x":-73.87473714752316,"y":40.79332234562324},{"x":-73.87802447550828,"y":40.79751808458303},{"x":-73.8816726806838,"y":40.80141725924976},{"x":-73.88565399800551,"y":40.80499019454982},{"x":-73.88993812724456,"y":40.80820969828819},{"x":-73.89449246359065,"y":40.81105126809742},{"x":-73.89928234579419,"y":40.813493277915484},{"x":-73.90427131995942,"y":40.815517142573135},{"x":-73.90942141698049,"y":40.81710745923828},{"x":-73.91469344150936,"y":40.81825212464084},{"x":-73.92004727025605,"y":40.81894242718595},{"x":-73.92544215735104,"y":40.81917311325441},{"x":-73.93083704444604,"y":40.81894242718595},{"x":-73.93619087319273,"y":40.81825212464084},{"x":-73.94146289772159,"y":40.81710745923828},{"x":-73.94661299474267,"y":40.815517142573135},{"x":-73.9516019689079,"y":40.813493277915484},{"x":-73.95639185111143,"y":40.81105126809742},{"x":-73.96094618745752,"y":40.80820969828819},{"x":-73.96523031669658,"y":40.80499019454982},{"x":-73.96921163401828,"y":40.80141725924976},{"x":-73.9728598391938,"y":40.79751808458303},{"x":-73.97614716717892,"y":40.79332234562324},{"x":-73.97904859942273,"y":40.78886197447732},{"x":-73.98154205427392,"y":40.784170917262934},{"x":-73.98360855503547,"y":40.77928487575804},{"x":-73.98523237438883,"y":40.77424103568874},{"x":-73.9864011540882,"y":40.769077783723525},{"x":-73.98710599901436,"y":40.76383441532751},{"x":-73.98734154487182,"y":40.75855083570022},{"x":-73.98710599901436,"y":40.75326725607293},{"x":-73.9864011540882,"y":40.748023887676915},{"x":-73.98523237438883,"y":40.7428606357117},{"x":-73.98360855503547,"y":40.7378167956424},{"x":-73.98154205427392,"y":40.732930754137506},{"x":-73.97904859942273,"y":40.72823969692312},{"x":-73.97614716717892,"y":40.7237793257772},{"x":-73.9728598391938,"y":40.71958358681741},{"x":-73.96921163401828,"y":40.71568441215068},{"x":-73.96523031669658,"y":40.712111476850616},{"x":-73.96094618745752,"y":40.70889197311225},{"x":-73.95639185111143,"y":40.70605040330302},{"x":-73.9516019689079,"y":40.703608393484956},{"x":-73.94661299474267,"y":40.701584528827304},{"x":-73.94146289772159,"y":40.69999421216216},{"x":-73.93619087319273,"y":40.6988495467596},{"x":-73.93083704444604,"y":40.69815924421449},{"x":-73.92544215735104,"y":40.69792855814603},{"x":-73.92004727025605,"y":40.69815924421449},{"x":-73.91469344150936,"y":40.6988495467596},{"x":-73.90942141698049,"y":40.69999421216216},{"x":-73.90427131995942,"y":40.701584528827304},{"x":-73.89928234579419,"y":40.703608393484956},{"x":-73.89449246359065,"y":40.70605040330302},{"x":-73.88993812724456,"y":40.708891973112245},{"x":-73.88565399800551,"y":40.712111476850616},{"x":-73.8816726806838,"y":40.71568441215068},{"x":-73.87802447550828,"y":40.71958358681741},{"x":-73.87473714752316,"y":40.7237793257772},{"x":-73.87183571527936,"y":40.72823969692312},{"x":-73.86934226042817,"y":40.732930754137506},{"x":-73.86727575966661,"y":40.7378167956424},{"x":-73.86565194031326,"y":40.7428606357117},{"x":-73.86448316061389,"y":40.748023887676915},{"x":-73.86377831568772,"y":40.75326725607293},{"x":-73.86354276983026,"y":40.75855083570022}]},"attributeFilter":null,"inputVectorClip":null},"contextSetting":null,"serviceInfo":{"targetDataPath":"F:/BaiduNetdiskDownload/result/8.smwu","targetServiceInfos":[{"serviceType":"RESTMAP","serviceAddress":"http://10.10.0.240:8090/iserver/services/map-8/rest"},{"serviceType":"RESTDATA","serviceAddress":"http://10.10.0.240:8090/iserver/services/data-8/rest"}]},"referServicesAddress":"http://10.10.0.240:8090/iserver"}}'
        list_jsonstr = '[' + single_jsonstr + ']'
        self.check_api(DistributedAnalyst.head_vector_clip,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/vectorclip.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr))
        self.check_api(DistributedAnalyst.get_vector_clip,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/vectorclip.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=list_jsonstr))
        entity = PostVectorClipEntity()
        entity.input = DatasetInputSetting()
        entity.input.datasetName = 'smtiles_processing_newyorkZone_R'
        entity.output = FileSystemOutputSetting()
        entity.output.type = OutputType.UDB
        entity.output.outputPath = 'F:/BaiduNetdiskDownload/result/8.smwu'
        entity.output.datasourcePath = 'F:/BaiduNetdiskDownload/result/8.udb'
        entity.analyst = OverlayAnalystGeoSetting()
        entity.analyst.datasetVectorClip = 'smtiles_processing_singleRegion_R'
        entity.analyst.mode = OverlayMode.clip
        post_jsonstr = '{"postResultType":"CreateChild","newResourceID":"36171a9f_1bec_45f9_90c0_6a3cf504ad89","succeed":true,"newResourceLocation":"http://10.10.0.240:8090/iserver/services/distributedanalyst/rest/v1/jobs/spatialanalyst/vectorclip/36171a9f_1bec_45f9_90c0_6a3cf504ad89"}'
        self.check_api(DistributedAnalyst.post_vector_clip,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/vectorclip.json",
                       HttpMethod.POST, httpretty.Response(status=200, body=post_jsonstr), entity=entity)
        self.check_api(DistributedAnalyst.head_vector_clip_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/vectorclip/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.HEAD, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
        self.check_api(DistributedAnalyst.get_vector_clip_job,
                       self.baseuri + "/services/distributedanalyst/rest/v1/jobs/spatialanalyst/vectorclip/30033df3_5834_41b2_8d0a_5be147d1e378.json",
                       HttpMethod.GET, httpretty.Response(status=200, body=single_jsonstr),
                       job_id='30033df3_5834_41b2_8d0a_5be147d1e378')
